from selenium.webdriver.common.by import By
from inputs import *



def identify_forms_and_form_inputs(driver):
    potential_forms = driver.find_elements(By.XPATH, "//*[contains(@class, 'form') or contains(@id, 'form')]")
    for p_form in potential_forms:
        p_inputs = p_form.find_elements(By.XPATH, ".//*[self::input or self::textarea or self::select]")
        for p_input in p_inputs:
            if p_input.get_attribute('name') != '':
                form_elements[p_input.get_attribute('name')] = p_input

def identify_all_inputs(driver):
    all_inputs = []

    # Standard input, textarea, and select tags
    standard_inputs = driver.find_elements(By.XPATH, ".//*[self::input or self::textarea or self::select]")
    all_inputs.extend(standard_inputs)

    # Input elements with role attributes (common in modern web apps)
    role_inputs = driver.find_elements(By.XPATH, "//*[@role='textbox' or @role='combobox']")
    all_inputs.extend(role_inputs)

    # Contenteditable elements (used as rich text editors, etc.)
    editable_inputs = driver.find_elements(By.XPATH, "//*[@contenteditable='true']")
    all_inputs.extend(editable_inputs)

    # Elements with common class names or IDs for custom inputs
    custom_inputs = driver.find_elements(By.XPATH, "//*[contains(@class, 'input') or contains(@id, 'input') or contains(@class, 'field')]")
    all_inputs.extend(custom_inputs)

    return set(all_inputs)


def identify_regular_inputs(driver):
    all_inputs = identify_all_inputs(driver)
    difference =  all_inputs.difference(form_elements.values())
    serialize_index = 1
    for element in difference:
        if element.get_attribute('name') == '' or element.get_attribute('name') == None:
            regular_inputs["element" + str(serialize_index)] = element
            serialize_index = serialize_index + 1
        else:
            regular_inputs[element.get_attribute('name')] = element
    
    reg = regular_inputs.copy()
    for name, element in reg.items():
        try:
            element.send_keys("a")
        except Exception:
            del regular_inputs[name]




